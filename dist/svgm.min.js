!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("svg.js")):"function"==typeof define&&define.amd?define(["exports","svg.js"],t):t((e=e||self).svgm={},e.SVG)}(this,function(e,o){"use strict";function M(e,t){var a=e[0],r=t[0],n=e[1],c=t[1];return Math.sqrt((r-=a)*r+(c-=n)*c)}function E(e){return{x:e[1],y:e[2]}}function P(e){var t=function(a,l,s){l||(l=1e-4);s||(s=3);for(var e=function e(t,a){var r=[t];for(var n=1,c=(a.d-t.d)/s;n<s;n++)r[n]=u(t.d+c*n);r.push(a);{if(h(r)<=l)return[t,a];for(var o=[],n=1;n<r.length;++n){var i=e(r[n-1],r[n]);i.pop(),o=o.concat(i)}return o.push(a),o}}(u(0),u(a.getTotalLength())),t=e.length;t--;)e[t]=[e[t].x,e[t].y];var r=a.ownerDocument.createElementNS("http://www.w3.org/2000/svg","polygon");return r.setAttribute("points",e.join(" ")),r;function u(e){var t=a.getPointAtLength(e);return t.d=e,t}function h(e){for(var t,a,r=0,n=e.length,c=0;c<n;++c)t=e[c],a=e[(c-1+n)%n],r+=(a.x+t.x)*(a.y-t.y);return Math.abs(r/2)}}(e,0);t.points.numberOfItems;return function(e){for(var t=0,a=e.points,r=a.numberOfItems,n=0;n<r;++n){var c=a.getItem(n),o=a.getItem((n+r-1)%r);t+=(o.x+c.x)*(o.y-c.y)}return Math.abs(t/2)}(t)}o=o&&o.hasOwnProperty("default")?o.default:o;var s="measure";function c(e,t){var a=u(e).label;if("scalebar"===a)return a;var r=e.type,n=e.attr().id,c={type:r,id:n,label:a},o=function(t,e,a){var r=t.type,n=e.split("-"),c={rect:["w","h","area","p","c"],ellipse:["area","w","h","p","c"],circle:["area","w","h","c","diameter"],path:["area","l","h","angle"],line:["l","h"],text:["t","y"],image:["file","folder"],g:["count","d","area"]};if(!c[r])return!1;var o=function(e,t){for(var a=0,r=[],n=0;n<t.length;n++)0<=(a=e.indexOf(t[n]))&&r.push(e[a]);return r}(n,c[r]);0===o.length&&(o={measure:{rect:["w","h"],ellipse:["w","h"],circle:["diameter"],path:["l"],line:["l"],text:["t"],image:["file","folder"],g:["count","d"]},strat:{ellipse:["c"],circle:["c"],line:["h","start"],path:["h","start"],text:["t","y"],g:["count"]}}[s][r]);if(!o)return!1;var i={};return o.forEach(function(e){i[e]=function(e,t,a){var r=e.attr(),n=0;switch(t){case"ellipse-c":n={x:e.cx()/a,y:e.cy()/a};break;case"ellipse-w":n=e.width()/a;break;case"ellipse-h":n=e.height()/a;break;case"line-l":case"line-h":var c=e.array().value,o=c[0],i=c[1];n=M(o,i)/a;break;case"line-start":var l=e.attr("x1"),s=e.attr("y1"),u=e.attr("y2");s<u&&(s=u),n={x:l,y:s};break;case"circle-c":n={x:e.cx()/a,y:e.cy()/a};break;case"circle-diameter":n=e.height()/a;break;case"rect-start":n={x:e.x()/a,y:e.y()/a};break;case"rect-c":n={x:e.cx()/a,y:e.cy()/a};break;case"rect-area":n=r.width*r.height/(a*a);break;case"rect-l":n=r.height/a;break;case"rect-w":n=e.width()/a;break;case"rect-h":n=e.height()/a;break;case"circle-area":var h=e.height()/2;n=Math.PI*(h*h)/(a*a);break;case"path-start":arrayPoints=e.array().value;var s=arrayPoints[0][2],l=0,f=arrayPoints.length;arrayPoints.forEach(function(e){s<e[2]&&(s=e[2]),l+=e[1]}),n={x:(l/=f)/a,y:s/a};break;case"path-h":n=e.length()/a;break;case"path-area":n=P(e.node)/(a*a);break;case"path-l":n=e.length()/a;break;case"path-angle":var c=e.array().value;n=3!=c.length?"err. path-angle must be with 3 points":function(e,t){void 0===t&&(t=!1);var a=E(e[1]),r=E(e[0]),n=E(e[2]),c=Math.sqrt(Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2)),o=Math.sqrt(Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2)),i=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)),l=Math.acos((Math.pow(c,2)+Math.pow(o,2)-Math.pow(i,2))/(2*c*o)),s=180*Math.acos((Math.pow(c,2)+Math.pow(o,2)-Math.pow(i,2))/(2*c*o))/Math.PI;return t?l:s}(c);break;case"text-t":if(1<e.node.childNodes.length){var p=SVG.select("tspan",e.node).members[0].node.textContent,m=SVG.select("desc",e.node).members[0],v=SVG.select("title",e.node).members[0],d="",b="";m&&(d="-"+m.node.textContent),v&&(b="-"+v.node.textContent);var n=p+b+d}else var n=e.text();break;case"text-y":n=e.attr("y")/a;break;case"image-file":var g=r["xlink:href"].split("/");n=g[g.length-1].split(".")[0];break;case"image-folder":var g=r["xlink:href"].split("/");n=g[g.length-2];break;case"g-d":var y=e.select("rect").members[0];if(y)var x=y.attr(),w=x.width*x.height/(a*a);var k=e.children().length-1;n=k/w;break;case"g-count":n=e.children().length-1}return n||"нет измерений"}(t,r+"-"+e,a)}),i}(e,n,t);o&&(c.measures=o);var i=SVG.select("desc",e.node).members[0],l=SVG.select("title",e.node).members[0];return i&&(c.desc=i.node.textContent),l&&(c.title=l.node.textContent),c}function u(e){var t=e.attr(),a=t["inkscape:label"];if(!a)return{label:t.id};if("number"==typeof a)return{label:a};var r=a.split("=");return{label:r[0],labelvalue:r[1]}}function i(e){var a=[];return e.forEach(function(e){var t=function(e){var t={path:function(e,t){var a=e.node.getAttribute("d"),r=a.indexOf("z"),n=e.length();return 0<r&&(alert("Масштабный отрезок в виде закрытой кривой! Это может привести к ошибочным вычислениям. Исправьте отрезок или используйте прямоугольник (rectangles) для масштабного отрезка"),n=e.length()/2),n/t},line:function(e,t){var a,r,n,c,o,i,l=e.array().value,s=l[0],u=l[1],h=(r=u,n=(a=s)[0],c=r[0],o=a[1],i=r[1],Math.sqrt((c-=n)*c+(i-=o)*i));return h/t},rect:function(e,t){var a=e.width(),r=e.height();return a<r&&(a=r),a/t}},a=e.type,r=u(e);if("scalebar"!==r.label)return!1;var n=Number(r.labelvalue);return t[a](e,n)}(e);t&&a.push({item:e,scalefactor:t})}),a}function l(e){var n=[];return e.forEach(function(e,t){var a,r;n.push((r={scalefactor:(a=e).scalefactor,elements:{image:[],text:[],path:[],line:[],rect:[],ellipse:[],circle:[],g:[]}},a.group.children().forEach(function(e){var t=c(e,a.scalefactor,SVG);"scalebar"!=t&&r.elements[t.type]&&r.elements[t.type].push(t)}),r))}),n}e.prepareSVG=function(e,t){if("undefined"!=typeof document){var r,a,n=function(e){void 0===e&&(e="");var t=document.createElement("DIV");t.setAttribute("id","svgcanvas"),t.setAttribute("hidden","true"),document.body.appendChild(t);var a=new o("svgcanvas");return a.clear(),a.svg(e),a}(e),c=l(function(e){var t=i(e.select("path").members),a=i(e.select("rect").members);a&&(t=t.concat(a));var r=i(e.select("line").members);r&&(t=t.concat(r));var n=[];return t&&t.forEach(function(e){var t=e.item.parent();n.push({group:t,scalefactor:e.scalefactor})}),n}(n));return r=t,a=[],c.forEach(function(e){var t=function(e){var t=e.elements,c={scalefactor:e.scalefactor},a=[];t.text.forEach(function(e){"name"===e.label&&(c.name=e.measures.t),"comments"!==e.label&&"comment"!==e.label||(c.comments=e.measures.t)}),t.image.forEach(function(e){c.imagefilename=e.measures.file,c.imagefoldername=e.measures.folder}),c.name||(c.name=c.imagefilename);var a=[];return t.path.forEach(function(e){a=a.concat(r(e))}),t.line.forEach(function(e){a=a.concat(r(e))}),t.rect.forEach(function(e){a=a.concat(r(e))}),t.ellipse.forEach(function(e){a=a.concat(r(e))}),t.circle.forEach(function(e){a=a.concat(r(e))}),t.g.forEach(function(e){a=a.concat(r(e))}),a;function r(e){var t=[];for(var a in e.measures){var r=e.measures[a];"number"==typeof r&&1<r&&(r=r.toFixed(2));var n={name:c.name,type:e.type+"-"+a,label:e.label,value:r,title:e.title||"",description:e.desc||"",comments:c.comments||""};t.push(n)}return t}}(e);a=a.concat(t)}),a.map(function(e,t,a){return e.filename=r,a[t]=e})}console.log("HTML DOM not found")},Object.defineProperty(e,"__esModule",{value:!0})});
